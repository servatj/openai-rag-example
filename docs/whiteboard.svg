<svg xmlns="http://www.w3.org/2000/svg" width="1600" height="900" viewBox="0 0 1600 900">
  <defs>
    <style>
      .bg { fill: #ffffff; }
      .title { font: 700 34px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; fill: #111827; }
      .subtitle { font: 500 18px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; fill: #374151; }
      .boxText { font: 600 18px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; fill: #111827; }
      .small { font: 500 15px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; fill: #374151; }
      .mono { font: 600 14px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; fill: #1f2937; }
      .marker { stroke: #0f172a; stroke-width: 3; stroke-linecap: round; stroke-linejoin: round; fill: none; }
      .markerThin { stroke: #0f172a; stroke-width: 2.2; stroke-linecap: round; stroke-linejoin: round; fill: none; }
      .accent { stroke: #2563eb; stroke-width: 4; stroke-linecap: round; stroke-linejoin: round; fill: none; }
      .note { fill: #fff7ed; stroke: #fb923c; stroke-width: 2.5; }
      .box { fill: #f8fafc; stroke: #0f172a; stroke-width: 3; }
      .chip { fill: #eef2ff; stroke: #4f46e5; stroke-width: 2; }
    </style>

    <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#0f172a" />
    </marker>
    <marker id="arrowBlue" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="9" markerHeight="9" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#2563eb" />
    </marker>
  </defs>

  <!-- Background -->
  <rect class="bg" x="0" y="0" width="1600" height="900"/>

  <!-- Title -->
  <text class="title" x="64" y="72">Product RAG – “whiteboard” architecture</text>
  <text class="subtitle" x="64" y="108">Ingest a PDF manual → embed chunks → vector search → answer with GPT using only retrieved context</text>

  <!-- Left: Ingestion lane -->
  <text class="boxText" x="64" y="170">Ingestion (offline / one-time)</text>

  <!-- PDF -->
  <rect class="box" x="64" y="200" rx="18" ry="18" width="310" height="110"/>
  <text class="boxText" x="92" y="245">PDF manual</text>
  <text class="mono" x="92" y="275">src/manuals/manual_drone.pdf</text>

  <!-- pdfLoader -->
  <rect class="box" x="430" y="200" rx="18" ry="18" width="310" height="110"/>
  <text class="boxText" x="458" y="245">PDF → text</text>
  <text class="mono" x="458" y="275">ingestion/pdfLoader.ts</text>

  <!-- chunker -->
  <rect class="box" x="796" y="200" rx="18" ry="18" width="310" height="110"/>
  <text class="boxText" x="824" y="245">Chunk text</text>
  <text class="mono" x="824" y="275">ingestion/chunker.ts</text>
  <text class="small" x="824" y="300">~800 words, 100 overlap</text>

  <!-- embedder -->
  <rect class="box" x="1162" y="200" rx="18" ry="18" width="374" height="110"/>
  <text class="boxText" x="1190" y="245">Embed chunks</text>
  <text class="mono" x="1190" y="275">ingestion/embedder.ts</text>
  <text class="small" x="1190" y="300">model: text-embedding-3-large</text>

  <!-- vector store -->
  <rect class="box" x="1162" y="340" rx="18" ry="18" width="374" height="130"/>
  <text class="boxText" x="1190" y="385">Vector store (in-memory)</text>
  <text class="mono" x="1190" y="415">vector/vectorStore.ts</text>
  <text class="small" x="1190" y="440">cosine similarity</text>
  <text class="small" x="1190" y="463">stores: { embedding, content }</text>

  <!-- Ingestion arrows -->
  <path class="marker" d="M 374 255 C 395 255, 405 255, 430 255" marker-end="url(#arrow)"/>
  <path class="marker" d="M 740 255 C 761 255, 771 255, 796 255" marker-end="url(#arrow)"/>
  <path class="marker" d="M 1106 255 C 1127 255, 1137 255, 1162 255" marker-end="url(#arrow)"/>
  <path class="marker" d="M 1349 310 C 1349 322, 1349 328, 1349 340" marker-end="url(#arrow)"/>

  <!-- Entry point note -->
  <rect class="note" x="64" y="340" rx="16" ry="16" width="676" height="130"/>
  <text class="boxText" x="92" y="385">Entry point</text>
  <text class="small" x="92" y="412">Run ingestion via:</text>
  <text class="mono" x="92" y="440">npm run start  →  src/index.ts</text>
  <text class="small" x="92" y="465">This populates the in-memory store for the current process.</text>

  <!-- Divider -->
  <path class="markerThin" d="M 64 520 L 1536 520"/>

  <!-- Right: Query lane -->
  <text class="boxText" x="64" y="580">Query (runtime)</text>

  <!-- Question -->
  <rect class="box" x="64" y="610" rx="18" ry="18" width="310" height="110"/>
  <text class="boxText" x="92" y="655">User question</text>
  <text class="mono" x="92" y="685">\"What is the battery life?\"</text>

  <!-- embed question -->
  <rect class="box" x="430" y="610" rx="18" ry="18" width="310" height="110"/>
  <text class="boxText" x="458" y="655">Embed question</text>
  <text class="mono" x="458" y="685">ingestion/embedder.ts</text>

  <!-- search -->
  <rect class="box" x="796" y="610" rx="18" ry="18" width="310" height="110"/>
  <text class="boxText" x="824" y="655">Vector search</text>
  <text class="mono" x="824" y="685">vector/vectorStore.ts</text>
  <text class="small" x="824" y="710">topK=5</text>

  <!-- context -->
  <rect class="box" x="1162" y="610" rx="18" ry="18" width="374" height="110"/>
  <text class="boxText" x="1190" y="655">Build context</text>
  <text class="mono" x="1190" y="685">rag/query.ts</text>
  <text class="small" x="1190" y="710">join chunks with separators</text>

  <!-- chat completion -->
  <rect class="chip" x="1162" y="745" rx="18" ry="18" width="374" height="110"/>
  <text class="boxText" x="1190" y="790">OpenAI chat completion</text>
  <text class="mono" x="1190" y="820">openai.chat.completions</text>
  <text class="small" x="1190" y="845">model: gpt-4.1-mini</text>

  <!-- Query arrows (blue highlight) -->
  <path class="accent" d="M 374 665 C 395 665, 405 665, 430 665" marker-end="url(#arrowBlue)"/>
  <path class="accent" d="M 740 665 C 761 665, 771 665, 796 665" marker-end="url(#arrowBlue)"/>
  <path class="accent" d="M 1106 665 C 1127 665, 1137 665, 1162 665" marker-end="url(#arrowBlue)"/>
  <path class="accent" d="M 1349 720 C 1349 732, 1349 738, 1349 745" marker-end="url(#arrowBlue)"/>

  <!-- Runtime note -->
  <rect class="note" x="64" y="745" rx="16" ry="16" width="676" height="110"/>
  <text class="boxText" x="92" y="790">CLI helper</text>
  <text class="mono" x="92" y="820">npm run ask \"...\"  →  src/cli.ts</text>
  <text class="small" x="92" y="845">CLI runs ingestion in-process, then calls the RAG query.</text>

  <!-- Env var -->
  <rect class="chip" x="796" y="745" rx="16" ry="16" width="310" height="110"/>
  <text class="boxText" x="824" y="790">Config</text>
  <text class="mono" x="824" y="820">OPENAI_API_KEY</text>
  <text class="small" x="824" y="845">src/config/openai.ts</text>
</svg>
